<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<code>nihexporter</code>: an R data package for NIH funding data • nihexporter</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">nihexporter</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/nihexporter.html">Intro</a>
    </li>
    <li>
      <a href="../articles/nihexporter-manuscript.html">bioRxiv pre-print</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/jayhesselberth/nihexporter">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>
<code>nihexporter</code>: an R data package for NIH funding data</h1>
                        <h4 class="author">Jay Hesselberth, Erin Baschal, Nick Ellinwood, Ashley Pacheco, Sally Peach, Mary Sweet, Yuying Wang</h4>
            
            <h4 class="date">Last update: 22 April, 2017</h4>
          </div>

    
    
<div class="contents">
<div id="abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>The National Institutes of Health (NIH) is the major source of federal funding for biomedical research in the United States. Analysis of past and current NIH funding can illustrate funding trends and identify productive research topics, but these analyses are conducted <em>ad hoc</em> by the institutes themselves and only provide a small glimpse of the available data. The NIH provides free access to funding data via NIH EXPORTER, but no tools have been developed to enable analysis of this data.</p>
</div>
<div id="results" class="section level2">
<h2 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h2>
<p>We developed the <code>nihexporter</code> R package, which provides access to <a href="http://exporter.nih.gov/">NIH EXPORTER</a> data. We used the package to develop several analysis vignettes that show funding trends across NIH institutes over 15 years and highlight differences in how institutes change their funding profiles. Investigators and institutions can use the package to perform self-studies of their own NIH funding.</p>
</div>
<div id="availability" class="section level2">
<h2 class="hasAnchor">
<a href="#availability" class="anchor"></a>Availability</h2>
<p>The <code>nihexporter</code> R package can be installed via <a href="https://github.com/jayhesselberth/nihexporter">github</a>.</p>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p>The <code>nihexporter</code> package is implemented in the R Statistical Computing Environment.</p>
</div>
<div id="contact" class="section level2">
<h2 class="hasAnchor">
<a href="#contact" class="anchor"></a>Contact</h2>
<p>Jay Hesselberth <a href="mailto:jay.hesselberth@gmail.com">jay.hesselberth@gmail.com</a>, University of Colorado School of Medicine</p>
</div>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The National Institutes of Health (NIH) is the major source federal funds for biomedical research in the United States. The NIH budget is approved by Congress each year, and in fiscal year 2014, the total NIH budget was 30.3 billion dollars (REF). The NIH is divided into 25 institutes, each with its own focus and mission. For example, National Cancer Institue (NCI) focuses on malignant diseases; the National Institute for Allergy and Immune Disease focuses on the immune system and transmissible diseasei; and the National Institute for General Medical Sciences focuses on basic research without a specific disease focus. Each institute negotiates with the NIH director (currently Francis Collins, MD, PhD) for its yearly budget, with budget institutes ranging from millions to several billion dollars.</p>
<p>The NIH provides funds through competetive grants written by internal and external investigators, and the funds associated with these grants can be divided into ‘direct’ and ‘indirect’ costs. <strong>Direct costs</strong> are funds that are given to an investigator (or group of investigators) to conduct their proposed research. These funds buy supplies for the experiments and pay the salaries of people to do the work.</p>
<p>By contrast, <strong>indirect costs</strong> are funds that are paid to institutions associated with investigators, and are used to “keep the lights on”: they pay for infrastructure costs. However, the “indirect cost recovery” (ICR) rate of each institution, the fraction of each award the institute receives, is congressionally mandated, and there is a wide range in ICR rates. Some of the highest ICR rates are close to 100%, meaning that for every dollar an investigator receives, the institutions receive an equal amount.</p>
<p>NIH funding is an investment strategy: the institutes invest money in specific research areas, hoping for future returns in the form of publications, patents and skilled trainees. As with any investment strategy, a periodic review can help rebalance the portfolio in order to maximize returns. Analysis of NIH funding data has been performed internally by the NIH, or by contracted third-parties. Several of these analyses have highlighted funding trends and suggested metrics to gauge the ‘return’ on the NIH ‘investment’. For example, “productivity” can be examined as a function of the number of publications produced by grants per dollar of “direct costs”.</p>
</div>
<div id="methods" class="section level1">
<h1 class="hasAnchor">
<a href="#methods" class="anchor"></a>Methods</h1>
<p>We downloaded NIH funding data from the NIH EXPORTER website in comma-separated value (CSV) format and parsed these data into R data files that each contain specific information:</p>
<ul>
<li>
<code>projects</code> has information about projects in each fiscal year, keyed by <code>project.num</code>
</li>
<li>
<code>org_info</code> has information about project organizations</li>
<li>
<code>project_orgs</code> links applications to organizations</li>
<li>
<code>project_pis</code> links PI information to a project</li>
<li>
<code>publinks</code> table links PubMed IDs to <code>project.num</code>
</li>
<li>
<code>publications</code> links project IDs to PubMed IDs</li>
<li>
<code>patents</code> links patent IDs to project IDs</li>
</ul>
<p>See the documentation in the R package for more information about each table.</p>
<p>The package also has several precomputed variables and tables that enable quick and easy exploratory analysis:</p>
<ul>
<li>
<code>nih.institutes</code>: Two-letter format for 27 NIH institutes</li>
<li>
<code>project_io</code>: This table contains pre-computed values for overall project cost (<code>project.cost</code>), as well as the number of publications (<code>n.pubs</code>) and patents (<code>n.patents</code>) associated with each project.</li>
</ul>
<p>NIH EXPORTER provides access to the total costs of each grant in each fiscal year, comprising both direct and indirect costs.</p>
<p>We developed several analyses using the <code>dplyr</code>, <code>ggplot2</code> and <code>knitr</code> packages in the RStudio environment.</p>
</div>
<div id="results-and-discussion" class="section level1">
<h1 class="hasAnchor">
<a href="#results-and-discussion" class="anchor"></a>Results and Discussion</h1>
<div id="project-costs" class="section level2">
<h2 class="hasAnchor">
<a href="#project-costs" class="anchor"></a>Project costs</h2>
<p>Let’s look at the costs of grants over time for a few institutes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(scales)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(nihexporter)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">select_inst &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'GM'</span>, <span class="st">'AI'</span>, <span class="st">'CA'</span>)
cost.over.time &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(institute, fy.cost, fiscal.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(institute <span class="op">%in%</span><span class="st"> </span>select_inst) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(fiscal.year, institute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">yearly.cost =</span> <span class="kw">sum</span>(fy.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

cost.over.time <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(fiscal.year), 
             <span class="dt">y =</span> yearly.cost <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>,
             <span class="dt">group =</span> institute, <span class="dt">color =</span> institute)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">'bottom'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">'Fiscal year'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">'Project costs (dollars in billions)'</span>)</code></pre></div>
<div class="figure">
<img src="nihexporter-manuscript_files/figure-html/inst_cost_over_time-1.png" alt="Project spending at NIGMS, NCI and NIAID" width="672"><p class="caption">
Project spending at NIGMS, NCI and NIAID
</p>
</div>
</div>
<div id="funding-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#funding-distributions" class="anchor"></a>Funding distributions</h2>
<div id="by-institution" class="section level3">
<h3 class="hasAnchor">
<a href="#by-institution" class="anchor"></a>By Institution</h3>
<p>Let’s look <em>where</em> the money is going. This example illustrates linking of the <code>project</code>, <code>org_info</code> and <code>project_orgs</code> tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">institution_funding &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(activity <span class="op">==</span><span class="st"> 'R01'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_orgs, <span class="dt">by =</span> <span class="st">'application.id'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(org.duns, fiscal.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total.dollars =</span> <span class="kw">sum</span>(fy.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(org_info, <span class="dt">by =</span> <span class="st">'org.duns'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total.dollars))

institution_funding <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(fiscal.year, org.name, org.duns, total.dollars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total.award.millions =</span> total.dollars <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>total.dollars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">caption=</span><span class="st">'R01 grant dollars awarded to specific institutions'</span>,
               <span class="dt">col.names=</span><span class="kw">c</span>(<span class="st">'Fiscal year'</span>, <span class="st">'Org.'</span>,
                           <span class="st">'DUNS'</span>, <span class="st">'Dollars (millions)'</span>))</code></pre></div>
<table class="table">
<caption>R01 grant dollars awarded to specific institutions</caption>
<thead><tr class="header">
<th align="right">Fiscal year</th>
<th align="left">Org.</th>
<th align="right">DUNS</th>
<th align="right">Dollars (millions)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2009</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">297.2806</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">292.9498</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">289.2175</td>
</tr>
<tr class="even">
<td align="right">2011</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">286.3747</td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">278.1270</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">273.9458</td>
</tr>
<tr class="odd">
<td align="right">2006</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">270.8518</td>
</tr>
<tr class="even">
<td align="right">2007</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">268.4021</td>
</tr>
<tr class="odd">
<td align="right">2003</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">266.1683</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="left">JOHNS HOPKINS UNIVERSITY</td>
<td align="right">1910777</td>
<td align="right">265.8217</td>
</tr>
</tbody>
</table>
<p>We can also identify movers-and-shakers by institution.</p>
</div>
<div id="by-pi" class="section level3">
<h3 class="hasAnchor">
<a href="#by-pi" class="anchor"></a>By PI</h3>
<p>One can also examine how dollars are accrued by specific PIs. It is not possible to assign dollars directly to a PI, because some grants have multiple investigators. Rather, these are total costs that a given PI has been associated with over all grants in NIH EXPORTER. Here we identify PIs with the largest dollar amounts accrued for R01 grants.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dollars.per.pi &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(activity <span class="op">==</span><span class="st"> 'R01'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_io, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_pis, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(pi.id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num, pi.id, total.cost) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(pi.id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pi.dollars =</span> <span class="kw">sum</span>(total.cost) <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(pi.dollars))  

dollars.per.pi <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">3</span>,
               <span class="dt">caption =</span> <span class="st">'R01 grant dollars associated with specific PIs'</span>,
               <span class="dt">col.names=</span><span class="kw">c</span>(<span class="st">'PI ID'</span>, <span class="st">'Dollars (millions)'</span>))</code></pre></div>
<table class="table">
<caption>R01 grant dollars associated with specific PIs</caption>
<thead><tr class="header">
<th align="right">PI ID</th>
<th align="right">Dollars (millions)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1888524</td>
<td align="right">99.854</td>
</tr>
<tr class="even">
<td align="right">1883846</td>
<td align="right">93.276</td>
</tr>
<tr class="odd">
<td align="right">2085656</td>
<td align="right">69.901</td>
</tr>
<tr class="even">
<td align="right">6719627</td>
<td align="right">69.901</td>
</tr>
<tr class="odd">
<td align="right">1858142</td>
<td align="right">58.942</td>
</tr>
<tr class="even">
<td align="right">1866338</td>
<td align="right">52.601</td>
</tr>
<tr class="odd">
<td align="right">1862760</td>
<td align="right">51.599</td>
</tr>
<tr class="even">
<td align="right">1876724</td>
<td align="right">47.021</td>
</tr>
<tr class="odd">
<td align="right">1878095</td>
<td align="right">43.606</td>
</tr>
<tr class="even">
<td align="right">1889062</td>
<td align="right">42.986</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="productivity" class="section level2">
<h2 class="hasAnchor">
<a href="#productivity" class="anchor"></a>Productivity</h2>
<p>In order to measure the “return” on the money the NIH invests in the research enterprise, we can measure scholarly output (i.e., publications) per dollar invested.</p>
<p>Here we identify th highest performing grants outside of the R01 category. Much has been made of the wasteful spending outside of investigator-initiated research. Here we identify the cost of publications for grants other than R01’s that cost more than 1 million dollars.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">high.perf.not.r01 &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(activity <span class="op">!=</span><span class="st"> 'R01'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_io, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num, total.cost, n.pubs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(total.cost <span class="op">&gt;</span><span class="st"> </span><span class="fl">1e6</span> <span class="op">&amp;</span><span class="st"> </span>n.pubs <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cost.per.pub =</span> total.cost <span class="op">/</span><span class="st"> </span>n.pubs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(cost.per.pub)

high.perf.not.r01 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total.cost =</span> <span class="kw">round</span>(total.cost <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>, <span class="dv">3</span>),
         <span class="dt">cost.per.pub =</span> <span class="kw">comma</span>(<span class="kw">round</span>(cost.per.pub, <span class="dv">0</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">caption=</span><span class="st">'Productivity (publications / dollar) of non-R01 grants'</span>,
               <span class="dt">col.names=</span><span class="kw">c</span>(<span class="st">'Project ID'</span>, <span class="st">'Project cost (dollars, millions)'</span>,
                           <span class="st">'Number of publications'</span>, <span class="st">'Cost per publications (dollars)'</span>))</code></pre></div>
<table class="table">
<caption>Productivity (publications / dollar) of non-R01 grants</caption>
<thead><tr class="header">
<th align="left">Project ID</th>
<th align="right">Project cost (dollars, millions)</th>
<th align="right">Number of publications</th>
<th align="left">Cost per publications (dollars)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">P30CA007175</td>
<td align="right">2.449</td>
<td align="right">721</td>
<td align="left">3,397</td>
</tr>
<tr class="even">
<td align="left">P30DK025295</td>
<td align="right">2.565</td>
<td align="right">691</td>
<td align="left">3,712</td>
</tr>
<tr class="odd">
<td align="left">P30DK025295</td>
<td align="right">2.565</td>
<td align="right">691</td>
<td align="left">3,712</td>
</tr>
<tr class="even">
<td align="left">P30DK025295</td>
<td align="right">2.565</td>
<td align="right">691</td>
<td align="left">3,712</td>
</tr>
<tr class="odd">
<td align="left">P30MH030929</td>
<td align="right">1.710</td>
<td align="right">444</td>
<td align="left">3,851</td>
</tr>
<tr class="even">
<td align="left">P30MH031302</td>
<td align="right">1.046</td>
<td align="right">266</td>
<td align="left">3,931</td>
</tr>
<tr class="odd">
<td align="left">P01CA018221</td>
<td align="right">2.727</td>
<td align="right">692</td>
<td align="left">3,941</td>
</tr>
<tr class="even">
<td align="left">P01CA018221</td>
<td align="right">2.727</td>
<td align="right">692</td>
<td align="left">3,941</td>
</tr>
<tr class="odd">
<td align="left">P41RR001008</td>
<td align="right">1.506</td>
<td align="right">366</td>
<td align="left">4,115</td>
</tr>
<tr class="even">
<td align="left">P41RR001008</td>
<td align="right">1.506</td>
<td align="right">366</td>
<td align="left">4,115</td>
</tr>
</tbody>
</table>
<p>We can also identify the specific publications associated with grants with the least expensive publications.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">high.perf.not.r01 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(publinks, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">caption=</span><span class="st">'Publications from the most productive grants'</span>,
               <span class="dt">col.names=</span><span class="kw">c</span>(<span class="st">'Project ID'</span>, <span class="st">'Pubmed ID'</span>))</code></pre></div>
<table class="table">
<caption>Publications from the most productive grants</caption>
<thead><tr class="header">
<th align="left">Project ID</th>
<th align="right">Pubmed ID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">P30CA007175</td>
<td align="right">3934045</td>
</tr>
<tr class="even">
<td align="left">P30CA007175</td>
<td align="right">2983611</td>
</tr>
<tr class="odd">
<td align="left">P30CA007175</td>
<td align="right">2856928</td>
</tr>
<tr class="even">
<td align="left">P30CA007175</td>
<td align="right">3863702</td>
</tr>
<tr class="odd">
<td align="left">P30CA007175</td>
<td align="right">3895298</td>
</tr>
</tbody>
</table>
<p>We can also identify productive PIs with current R01s …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">productive.pis &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(activity <span class="op">==</span><span class="st"> 'R01'</span> <span class="op">&amp;</span><span class="st"> </span>fiscal.year <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_io, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_pis, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(pi.id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total.pi.dollars =</span> <span class="kw">sum</span>(total.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">total.pubs =</span> <span class="kw">sum</span>(n.pubs)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pub.cost =</span> total.pi.dollars <span class="op">/</span><span class="st"> </span>total.pubs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># prevent PI Ids from being commafied</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pi.id =</span> <span class="kw">as.character</span>(pi.id)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(pub.cost)

productive.pis <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">0</span>,
               <span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">','</span>),
               <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">'PI ID'</span>,
                             <span class="st">'Cost per publication (dollars)'</span>,
                             <span class="st">'Total publications'</span>,
                             <span class="st">'Total project costs (dollars)'</span>))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">PI ID</th>
<th align="right">Cost per publication (dollars)</th>
<th align="right">Total publications</th>
<th align="right">Total project costs (dollars)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1891786</td>
<td align="right">498,708</td>
<td align="right">105</td>
<td align="right">4,750</td>
</tr>
<tr class="even">
<td align="left">1888041</td>
<td align="right">2,429,682</td>
<td align="right">312</td>
<td align="right">7,787</td>
</tr>
<tr class="odd">
<td align="left">1876101</td>
<td align="right">5,733,230</td>
<td align="right">589</td>
<td align="right">9,734</td>
</tr>
<tr class="even">
<td align="left">1875446</td>
<td align="right">5,517,970</td>
<td align="right">517</td>
<td align="right">10,673</td>
</tr>
<tr class="odd">
<td align="left">1880305</td>
<td align="right">1,047,303</td>
<td align="right">92</td>
<td align="right">11,384</td>
</tr>
<tr class="even">
<td align="left">1891745</td>
<td align="right">1,441,602</td>
<td align="right">124</td>
<td align="right">11,626</td>
</tr>
<tr class="odd">
<td align="left">2232971</td>
<td align="right">1,665,822</td>
<td align="right">133</td>
<td align="right">12,525</td>
</tr>
<tr class="even">
<td align="left">1877469</td>
<td align="right">1,198,769</td>
<td align="right">95</td>
<td align="right">12,619</td>
</tr>
<tr class="odd">
<td align="left">1861696</td>
<td align="right">1,629,417</td>
<td align="right">129</td>
<td align="right">12,631</td>
</tr>
<tr class="even">
<td align="left">1888187</td>
<td align="right">1,629,417</td>
<td align="right">129</td>
<td align="right">12,631</td>
</tr>
</tbody>
</table>
<p>Or we can identify the all-time most produtive PIs, independent of grant type or time frame …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">productive.pis.all.time &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num, activity) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_io, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_pis, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(pi.id, activity) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total.pi.dollars =</span> <span class="kw">sum</span>(total.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">total.pubs =</span> <span class="kw">sum</span>(n.pubs),
            <span class="dt">total.patents =</span> <span class="kw">sum</span>(n.patents)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(total.pi.dollars <span class="op">&gt;=</span><span class="st"> </span><span class="fl">1e6</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pub.cost =</span> total.pi.dollars <span class="op">/</span><span class="st"> </span>total.pubs,
         <span class="dt">patent.cost =</span> total.pi.dollars <span class="op">/</span><span class="st"> </span>total.patents) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(pi.id, activity, pub.cost, patent.cost, 
         total.pubs, total.patents, total.pi.dollars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pi.id =</span> <span class="kw">as.character</span>(pi.id))

productive.pis.all.time <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>patent.cost, <span class="op">-</span>total.patents) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(pub.cost) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">0</span>,
               <span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">','</span>),
               <span class="dt">caption =</span> <span class="st">'Most productive PIs all time for publications'</span>,
               <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">'PI ID'</span>, <span class="st">'Grant type'</span>,
                             <span class="st">'Cost per publication (dollars)'</span>,
                             <span class="st">'Total publications'</span>,
                             <span class="st">'Total dollars'</span>))</code></pre></div>
<table class="table">
<caption>Most productive PIs all time for publications</caption>
<thead><tr class="header">
<th align="left">PI ID</th>
<th align="left">Grant type</th>
<th align="right">Cost per publication (dollars)</th>
<th align="right">Total publications</th>
<th align="right">Total dollars</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">7846601</td>
<td align="left">K01</td>
<td align="right">1,191</td>
<td align="right">2,080</td>
<td align="right">2,477,445</td>
</tr>
<tr class="even">
<td align="left">1859703</td>
<td align="left">R01</td>
<td align="right">1,606</td>
<td align="right">2,651</td>
<td align="right">4,258,588</td>
</tr>
<tr class="odd">
<td align="left">2412990</td>
<td align="left">R13</td>
<td align="right">1,996</td>
<td align="right">1,840</td>
<td align="right">3,673,380</td>
</tr>
<tr class="even">
<td align="left">1864203</td>
<td align="left">R37</td>
<td align="right">2,900</td>
<td align="right">360</td>
<td align="right">1,044,032</td>
</tr>
<tr class="odd">
<td align="left">1867565</td>
<td align="left">K22</td>
<td align="right">2,912</td>
<td align="right">459</td>
<td align="right">1,336,743</td>
</tr>
<tr class="even">
<td align="left">6195169</td>
<td align="left">K24</td>
<td align="right">2,958</td>
<td align="right">1,912</td>
<td align="right">5,655,968</td>
</tr>
<tr class="odd">
<td align="left">10272731</td>
<td align="left">ZIA</td>
<td align="right">2,966</td>
<td align="right">462</td>
<td align="right">1,370,516</td>
</tr>
<tr class="even">
<td align="left">6224670</td>
<td align="left">Z01</td>
<td align="right">3,026</td>
<td align="right">386</td>
<td align="right">1,168,074</td>
</tr>
<tr class="odd">
<td align="left">8189566</td>
<td align="left">Z01</td>
<td align="right">3,026</td>
<td align="right">386</td>
<td align="right">1,168,074</td>
</tr>
<tr class="even">
<td align="left">9693943</td>
<td align="left">Z01</td>
<td align="right">3,026</td>
<td align="right">386</td>
<td align="right">1,168,074</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
productive.pis.all.time <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>pub.cost, <span class="op">-</span>total.pubs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(patent.cost) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">0</span>,
               <span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">','</span>),
               <span class="dt">caption =</span> <span class="st">'Most productive PIs all time for patents'</span>,
               <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">'PI ID'</span>, <span class="st">'Grant type'</span>,
                             <span class="st">'Cost per patent (dollars)'</span>,
                             <span class="st">'Total patents'</span>,
                             <span class="st">'Total dollars'</span>))</code></pre></div>
<table class="table">
<caption>Most productive PIs all time for patents</caption>
<thead><tr class="header">
<th align="left">PI ID</th>
<th align="left">Grant type</th>
<th align="right">Cost per patent (dollars)</th>
<th align="right">Total patents</th>
<th align="right">Total dollars</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1892862</td>
<td align="left">R13</td>
<td align="right">30,984</td>
<td align="right">184</td>
<td align="right">5,700,986</td>
</tr>
<tr class="even">
<td align="left">1883257</td>
<td align="left">R01</td>
<td align="right">35,226</td>
<td align="right">183</td>
<td align="right">6,446,436</td>
</tr>
<tr class="odd">
<td align="left">1863886</td>
<td align="left">R01</td>
<td align="right">35,634</td>
<td align="right">125</td>
<td align="right">4,454,270</td>
</tr>
<tr class="even">
<td align="left">1928069</td>
<td align="left">K08</td>
<td align="right">41,130</td>
<td align="right">27</td>
<td align="right">1,110,510</td>
</tr>
<tr class="odd">
<td align="left">7700352</td>
<td align="left">R21</td>
<td align="right">50,081</td>
<td align="right">20</td>
<td align="right">1,001,626</td>
</tr>
<tr class="even">
<td align="left">1884090</td>
<td align="left">K26</td>
<td align="right">54,663</td>
<td align="right">50</td>
<td align="right">2,733,145</td>
</tr>
<tr class="odd">
<td align="left">1888479</td>
<td align="left">K05</td>
<td align="right">55,467</td>
<td align="right">230</td>
<td align="right">12,757,500</td>
</tr>
<tr class="even">
<td align="left">1896779</td>
<td align="left">R01</td>
<td align="right">56,486</td>
<td align="right">26</td>
<td align="right">1,468,630</td>
</tr>
<tr class="odd">
<td align="left">8259763</td>
<td align="left">R01</td>
<td align="right">56,513</td>
<td align="right">32</td>
<td align="right">1,808,418</td>
</tr>
<tr class="even">
<td align="left">1881108</td>
<td align="left">T32</td>
<td align="right">57,916</td>
<td align="right">40</td>
<td align="right">2,316,625</td>
</tr>
</tbody>
</table>
<p>When <a href="http://www.nigms.nih.gov/about/director/pages/berg.aspx">Jeremy Berg</a> was head of the Institute of General Medical Sciences (NIGMS) from 2003-2011, he routinely provided analysis of funding trends at NIGMS in his “Feedback Loop” blog. One of these measured the productivity per grant dollar by measuring its “scholarly output” (<em>i.e.</em>, publications) as a function of direct costs. In this <a href="http://loop.nigms.nih.gov/2010/09/measuring-the-scientific-output-and-impact-of-nigms-grants/">plot</a> there is an increase in productivity per dollar, until an inflection point at $700K, after which the number of publications <em>drops</em>, suggesting a negative influence of grant money on scholarly output. This was interesting and covered <a href="http://www.nature.com/news/2010/101116/full/468356a.html">here</a>.</p>
<p>Here we flesh out this analysis and look at how all institutes perform by this measure (Berg, and now Lorsch, only analyzed GM). One caveat is that we only have access to <code>total.cost</code> in NIH EXPORTER, so the numbers include indirect costs. But, this is real cost to the tax-payer.</p>
<p>First, we need to calculate the lifetime costs of all R01 grants.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate costs of all grants, over the entire lifetime of the grant</span>
grant_costs &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(institute <span class="op">%in%</span><span class="st"> </span>nih.institutes <span class="op">&amp;</span><span class="st"> </span>activity <span class="op">==</span><span class="st"> 'R01'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_io, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(institute, project.num, total.cost, n.pubs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unique</span>()

grant_costs
<span class="co">#&gt; # A tibble: 87,216 × 4</span>
<span class="co">#&gt;    institute project.num total.cost n.pubs</span>
<span class="co">#&gt;       &lt;fctr&gt;       &lt;chr&gt;      &lt;dbl&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1         AA R01AA000187     192057     44</span>
<span class="co">#&gt; 2         AA R01AA000279    1368179      1</span>
<span class="co">#&gt; 3         AA R01AA000626    4256757     94</span>
<span class="co">#&gt; 4         AA R01AA002666    2635998    160</span>
<span class="co">#&gt; 5         AA R01AA002686    7088071     59</span>
<span class="co">#&gt; 6         AA R01AA003037     710028     12</span>
<span class="co">#&gt; 7         AA R01AA003490    2285856     31</span>
<span class="co">#&gt; 8         AA R01AA003972    2695918     51</span>
<span class="co">#&gt; 9         AA R01AA004610    5035947     32</span>
<span class="co">#&gt; 10        AA R01AA004961     477993     68</span>
<span class="co">#&gt; # ... with 87,206 more rows</span></code></pre></div>
<p>Next, we need to identify grants in each of the bins that Berg previously alluded to. <code>dplyr</code> makes this easy with the <code>ntile()</code> function. Berg previously divided grants into ~15 bins, we’ll bin into ~5%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bin_grant_costs &lt;-<span class="st"> </span>grant_costs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(institute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="dt">n.tile =</span> <span class="kw">ntile</span>(total.cost, <span class="dv">20</span>)) 

bin_grant_costs
<span class="co">#&gt; Source: local data frame [87,216 x 5]</span>
<span class="co">#&gt; Groups: n.tile [21]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    institute project.num total.cost n.pubs n.tile</span>
<span class="co">#&gt;       &lt;fctr&gt;       &lt;chr&gt;      &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1         AA R01AA000187     192057     44      1</span>
<span class="co">#&gt; 2         AA R01AA000279    1368179      1     10</span>
<span class="co">#&gt; 3         AA R01AA000626    4256757     94     20</span>
<span class="co">#&gt; 4         AA R01AA002666    2635998    160     17</span>
<span class="co">#&gt; 5         AA R01AA002686    7088071     59     20</span>
<span class="co">#&gt; 6         AA R01AA003037     710028     12      5</span>
<span class="co">#&gt; 7         AA R01AA003490    2285856     31     16</span>
<span class="co">#&gt; 8         AA R01AA003972    2695918     51     17</span>
<span class="co">#&gt; 9         AA R01AA004610    5035947     32     20</span>
<span class="co">#&gt; 10        AA R01AA004961     477993     68      3</span>
<span class="co">#&gt; # ... with 87,206 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Berg's original values ...</span>
<span class="co"># breaks &lt;- c(175000, 200000, 225000, 250000, 300000, 375000, 400000,</span>
<span class="co">#           450000, 500000, 600000, 700000, 800000, 900000, 1000000)</span>
min.lifetime.cost &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">min</span>(grant_costs<span class="op">$</span>total.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="op">-</span><span class="dv">4</span>) <span class="co"># round to 10,000s</span>
max.lifetime.cost &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">max</span>(grant_costs<span class="op">$</span>total.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="op">-</span><span class="dv">5</span>) 
<span class="co"># step is average size of an award</span>
step &lt;-<span class="st"> </span><span class="fl">1e6</span>

breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(min.lifetime.cost, max.lifetime.cost, step)
breaks
<span class="co">#&gt;  [1] 0.0e+00 1.0e+06 2.0e+06 3.0e+06 4.0e+06 5.0e+06 6.0e+06 7.0e+06</span>
<span class="co">#&gt;  [9] 8.0e+06 9.0e+06 1.0e+07 1.1e+07 1.2e+07 1.3e+07 1.4e+07 1.5e+07</span>
<span class="co">#&gt; [17] 1.6e+07 1.7e+07 1.8e+07 1.9e+07 2.0e+07 2.1e+07 2.2e+07 2.3e+07</span>
<span class="co">#&gt; [25] 2.4e+07 2.5e+07 2.6e+07 2.7e+07 2.8e+07 2.9e+07 3.0e+07 3.1e+07</span>
<span class="co">#&gt; [33] 3.2e+07 3.3e+07 3.4e+07 3.5e+07 3.6e+07 3.7e+07 3.8e+07 3.9e+07</span>
<span class="co">#&gt; [41] 4.0e+07 4.1e+07 4.2e+07 4.3e+07 4.4e+07 4.5e+07 4.6e+07 4.7e+07</span>
<span class="co">#&gt; [49] 4.8e+07 4.9e+07 5.0e+07 5.1e+07 5.2e+07 5.3e+07 5.4e+07 5.5e+07</span>
<span class="co">#&gt; [57] 5.6e+07 5.7e+07 5.8e+07 5.9e+07 6.0e+07 6.1e+07 6.2e+07 6.3e+07</span>
<span class="co">#&gt; [65] 6.4e+07 6.5e+07 6.6e+07 6.7e+07 6.8e+07 6.9e+07 7.0e+07 7.1e+07</span>
<span class="co">#&gt; [73] 7.2e+07 7.3e+07 7.4e+07 7.5e+07 7.6e+07 7.7e+07</span>

dollar_bin_grant_costs &lt;-<span class="st"> </span>grant_costs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(institute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dollar.tile =</span> <span class="kw">findInterval</span>(total.cost, <span class="dt">vec =</span> breaks, 
                                    <span class="dt">all.inside =</span> <span class="ot">TRUE</span>, <span class="dt">rightmost.closed =</span> <span class="ot">TRUE</span>))

dollar_bin_grant_costs
<span class="co">#&gt; Source: local data frame [87,216 x 5]</span>
<span class="co">#&gt; Groups: institute [24]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    institute project.num total.cost n.pubs dollar.tile</span>
<span class="co">#&gt;       &lt;fctr&gt;       &lt;chr&gt;      &lt;dbl&gt;  &lt;int&gt;       &lt;int&gt;</span>
<span class="co">#&gt; 1         AA R01AA000187     192057     44           1</span>
<span class="co">#&gt; 2         AA R01AA000279    1368179      1           2</span>
<span class="co">#&gt; 3         AA R01AA000626    4256757     94           5</span>
<span class="co">#&gt; 4         AA R01AA002666    2635998    160           3</span>
<span class="co">#&gt; 5         AA R01AA002686    7088071     59           8</span>
<span class="co">#&gt; 6         AA R01AA003037     710028     12           1</span>
<span class="co">#&gt; 7         AA R01AA003490    2285856     31           3</span>
<span class="co">#&gt; 8         AA R01AA003972    2695918     51           3</span>
<span class="co">#&gt; 9         AA R01AA004610    5035947     32           6</span>
<span class="co">#&gt; 10        AA R01AA004961     477993     68           1</span>
<span class="co">#&gt; # ... with 87,206 more rows</span>

dollar_bin_grant_costs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dollar.tile) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())
<span class="co">#&gt; # A tibble: 37 × 2</span>
<span class="co">#&gt;    dollar.tile count</span>
<span class="co">#&gt;          &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1            1 23414</span>
<span class="co">#&gt; 2            2 35040</span>
<span class="co">#&gt; 3            3 12911</span>
<span class="co">#&gt; 4            4  6583</span>
<span class="co">#&gt; 5            5  2865</span>
<span class="co">#&gt; 6            6  1198</span>
<span class="co">#&gt; 7            7   527</span>
<span class="co">#&gt; 8            8   243</span>
<span class="co">#&gt; 9            9   123</span>
<span class="co">#&gt; 10          10    95</span>
<span class="co">#&gt; # ... with 27 more rows</span></code></pre></div>
<p>That looks better. Now we can make the summary plots …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
dollar_bin_grant_costs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># need to remove higher tiles because there are too few grants</span>
<span class="st">  </span><span class="kw">filter</span>(dollar.tile <span class="op">&lt;=</span><span class="st"> </span><span class="dv">13</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(dollar.tile), <span class="dt">y =</span> n.pubs)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels =</span> breaks <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">45</span>, <span class="dt">vjust=</span><span class="fl">0.8</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>institute, <span class="dt">scales =</span> <span class="st">"free_x"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">'Number of publications'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">'Total costs (minimum, in millions)'</span>)</code></pre></div>
<div class="figure">
<img src="nihexporter-manuscript_files/figure-html/plot.dollar.bins-1.png" alt="Productivity versus grant costs for each institute." width="672"><p class="caption">
Productivity versus grant costs for each institute.
</p>
</div>
</div>
<div id="comparison-of-grant-programs" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-grant-programs" class="anchor"></a>Comparison of grant programs</h2>
<p>The NIH provides funds through differet <a href="http://grants.nih.gov/grants/funding/funding_program.htm">grant programs</a>:</p>
<ul>
<li><p><code>research</code>: investigator-intitiated, actvities begin with <code>R</code> (e.g., R01)</p></li>
<li><p><code>program</code>: activities begin with <code>P</code> (e.g. P01)</p></li>
<li><p><code>cooperative agreements</code>: actvities begin with <code>U</code> (e.g. U54)</p></li>
</ul>
<p>We can examine the total costs spent on specific grants and specific institutes over time.</p>
<div class="figure">
<img src="nihexporter-manuscript_files/figure-html/institute_funds-1.png" alt="Funds for specific types of grants at the GM, CA and AI institutes" width="672"><p class="caption">
Funds for specific types of grants at the GM, CA and AI institutes
</p>
</div>
<p>Or we can see how institutes allocate money generally to different types of grants.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># from http://grants.nih.gov/grants/funding/funding_program.htm</span>
research_projects &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">'^R'</span>, activity)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(project.num)
program_projects &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">'^P'</span>, activity)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(project.num)
coop_projects &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">'^U'</span>, activity)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(project.num)

select_inst &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'AI'</span>,<span class="st">'CA'</span>,<span class="st">'GM'</span>,<span class="st">'HG'</span>,<span class="st">'AA'</span>,<span class="st">'MH'</span>)
                
grant_costs &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(institute <span class="op">%in%</span><span class="st"> </span>nih.institutes) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num, institute, fiscal.year, fy.cost)

research_costs &lt;-<span class="st"> </span>grant_costs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(research_projects, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(project.num, institute, fiscal.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">project.cost =</span> <span class="kw">sum</span>(fy.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="st">'research'</span>)

program_costs &lt;-<span class="st"> </span>grant_costs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(program_projects, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(project.num, institute, fiscal.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">project.cost =</span> <span class="kw">sum</span>(fy.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="st">'program'</span>)

coop_costs &lt;-<span class="st"> </span>grant_costs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(coop_projects, <span class="dt">by =</span> <span class="st">'project.num'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(project.num, institute, fiscal.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">project.cost =</span> <span class="kw">sum</span>(fy.cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="st">'cooperative agreements'</span>)

combined_tbl &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(research_costs, program_costs, coop_costs)

<span class="kw">ggplot</span>(combined_tbl, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(fiscal.year),
                         <span class="dt">y =</span> project.cost,
                         <span class="dt">fill =</span> type)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">1e4</span>,<span class="fl">1e7</span>),
                <span class="dt">labels =</span> <span class="kw">trans_format</span>(<span class="st">"log10"</span>, <span class="kw">math_format</span>(<span class="dv">10</span><span class="op">^</span>.x))) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>institute) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">"Dark2"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">'bottom'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">''</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">'Total grant costs, log-scaled'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>))</code></pre></div>
<div class="figure">
<img src="nihexporter-manuscript_files/figure-html/activity_comparisons-1.png" alt="Comparison of research, program and coop costs over time" width="672"><p class="caption">
Comparison of research, program and coop costs over time
</p>
</div>
</div>
<div id="duration" class="section level2">
<h2 class="hasAnchor">
<a href="#duration" class="anchor"></a>Duration</h2>
<p>The <code>nihexporter</code> exposes <code>project.start</code> and <code>project.end</code>, which we can use to examine the duration of projects. For example, we can identify the longest running R01 grants.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long.grants &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(activity <span class="op">==</span><span class="st"> 'R01'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num, project.start, project.end) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(project.num) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">longest.run =</span> <span class="kw">max</span>(project.end) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(project.start)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(longest.run)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">in.years =</span> <span class="kw">as.numeric</span>(longest.run) <span class="op">/</span><span class="st"> </span><span class="dv">365</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project.num, in.years)

long.grants <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>,
               <span class="dt">caption =</span> <span class="st">'Longest running R01 grants (all-time)'</span>,
               <span class="dt">col.names=</span><span class="kw">c</span>(<span class="st">'Project ID'</span>, <span class="st">'Duration (years)'</span>))</code></pre></div>
<table class="table">
<caption>Longest running R01 grants (all-time)</caption>
<thead><tr class="header">
<th align="left">Project ID</th>
<th align="right">Duration (years)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">R01HL009610</td>
<td align="right">51.03</td>
</tr>
<tr class="even">
<td align="left">R01HL013629</td>
<td align="right">47.03</td>
</tr>
<tr class="odd">
<td align="left">R01HD008188</td>
<td align="right">44.61</td>
</tr>
<tr class="even">
<td align="left">R01DC005259</td>
<td align="right">43.44</td>
</tr>
<tr class="odd">
<td align="left">R01CA020525</td>
<td align="right">43.27</td>
</tr>
<tr class="even">
<td align="left">R01GM013306</td>
<td align="right">43.03</td>
</tr>
<tr class="odd">
<td align="left">R01HL016037</td>
<td align="right">42.94</td>
</tr>
<tr class="even">
<td align="left">R01CA013202</td>
<td align="right">42.86</td>
</tr>
<tr class="odd">
<td align="left">R01CA019033</td>
<td align="right">42.78</td>
</tr>
<tr class="even">
<td align="left">R01DK013499</td>
<td align="right">42.36</td>
</tr>
</tbody>
</table>
<div id="geographical-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#geographical-distribution" class="anchor"></a>Geographical distribution</h3>
<p>Geographical distribution of grant dollar is easily visualized using the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">org.state =</span> state.abb,
                         <span class="dt">state.name =</span> <span class="kw">tolower</span>(state.name))

state_funding &lt;-<span class="st"> </span>projects <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(application.id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(project_orgs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(org_info) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(projects, <span class="dt">by =</span> <span class="st">'application.id'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(application.id, org.state, fy.cost) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(org.state) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total.fy.cost =</span> <span class="kw">sum</span>(fy.cost) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)

cost.by.state &lt;-<span class="st"> </span>state_funding <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(state.data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(state.name, total.fy.cost) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(state.name <span class="op">!=</span><span class="st"> "NA"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">region=</span>state.name, <span class="dt">cost =</span> total.fy.cost) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(region, cost) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data.frame</span>()

state.map.data &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">"state"</span>)

plot_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(state.map.data, cost.by.state)

<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>plot_data, 
                      <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">group =</span> group, <span class="dt">fill=</span>plot_data<span class="op">$</span>cost),
                      <span class="dt">colour=</span><span class="st">"black"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">low =</span> <span class="st">"lightgrey"</span>, <span class="dt">high =</span> <span class="st">"red"</span>, <span class="dt">guide=</span><span class="st">"colorbar"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">"Total Cost per year </span><span class="ch">\n</span><span class="st"> (Billions of dollars)"</span>,<span class="dt">x=</span><span class="st">""</span>, <span class="dt">y=</span><span class="st">""</span>) <span class="op">+</span>
<span class="st">       </span><span class="co">#title = "Total cost per fiscal year by state" </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.border =</span>  <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="fl">1.4</span>)</code></pre></div>
</div>
</div>
</div>
<div id="acknowledgments" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgments" class="anchor"></a>Acknowledgments</h1>
<p>The <code>nihexporter</code> package was developed over several weeks during a course on data analysis (<a href="http://molb7621.github.io" class="uri">http://molb7621.github.io</a>). Thanks to the NIH EXPORTER team for fixing issues with the EXPORTER tables.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#abstract">Abstract</a><ul class="nav nav-pills nav-stacked">
<li><a href="#motivation">Motivation</a></li>
      <li><a href="#results">Results</a></li>
      <li><a href="#availability">Availability</a></li>
      <li><a href="#implementation">Implementation</a></li>
      <li><a href="#contact">Contact</a></li>
      </ul>
</li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#methods">Methods</a></li>
      <li>
<a href="#results-and-discussion">Results and Discussion</a><ul class="nav nav-pills nav-stacked">
<li><a href="#project-costs">Project costs</a></li>
      <li><a href="#funding-distributions">Funding distributions</a></li>
      <li><a href="#productivity">Productivity</a></li>
      <li><a href="#comparison-of-grant-programs">Comparison of grant programs</a></li>
      <li><a href="#duration">Duration</a></li>
      </ul>
</li>
      <li><a href="#acknowledgments">Acknowledgments</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jay Hesselberth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
